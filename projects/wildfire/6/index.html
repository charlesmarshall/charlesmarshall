<!doctype html>
<html lang="en" id="projects">
  <head>
<!--[if IE]>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
<![endif]-->

<!--[if lte IE 8]>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
<style>
         .chromeFrameInstallDefaultStyle {
           width: 800px;
           border: 2px solid #222;
           z-index: 99999;
         }
        </style>

        <script>
         // The conditional ensures that this code will only execute in IE,
         // Therefore we can use the IE-specific attachEvent without worry
         window.attachEvent("onload", function() {
            if(typeof(chromeframe_disable) == "undefined") {
               CFInstall.check({
                 mode: "inline", // the default
                 oninstall: function(){
                    alert("Chrome Frame is now installed. You may need to restart your browser.");
                 }
               });
            }
         });

        </script>
<![endif]-->
<head>
<!--[if IE]>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
<![endif]-->

<!--[if lte IE 6]>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
<style>
         .chromeFrameInstallDefaultStyle {
           width: 800px;
           border: 2px solid #222;
           z-index: 99999;
         }
        </style>

        <script>
         // The conditional ensures that this code will only execute in IE,
         // Therefore we can use the IE-specific attachEvent without worry
         window.attachEvent("onload", function() {
            if(typeof(chromeframe_disable) == "undefined") {
               CFInstall.check({
                 mode: "inline", // the default
                 oninstall: function(){
                    alert("Chrome Frame is now installed. You may need to restart your browser.");
                 }
               });
            }
         });

        </script>
<![endif]-->

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,400,300,600,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Oleo+Script' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="/stylesheets/build.css" type="text/css" media="all" charset="utf-8" >

    <title>Version 6 of Wildfire CMS - Projects - Charles Marshall</title>
  </head>
  <body id="wildfire-cms">

    <header id="header">
      <nav id="navigation" class='clearfix'>
        <a href="/" class='home'>Home</a>

        <a href="/demos/" class='demos'>Demos</a>
        <a href="/projects/" class='projects'>Projects</a>
      </nav>
    </header>

    <section id="intro">
      <h1>Wildfire CMS version 6</h1>
      <p>By converting all the content to run as a tree structure instead of the older idea of sections and content being split you can imagine how substantical a change this was.</p>
      <p>I'll go over the main changes very briefly and work on the silly presumption that you know or have used Wildfire CMS or at <a href="/projects/wildfire/basics/">least read the basics</a>.</p>
    </section>

    <section id="delete-everything" class='feature'>
      <h2>Delete hammer</h2>
      <p>The fun part of any big revision; clearing out all that excess code and trying to trim it down to the bare bones ready to start again. Back in Feburary 2011 I began the adventure of changing everything by <a href="https://github.com/phpwax/wildfire/commit/12b34b2693b94459f75535b16e68bb359f25d0ba">clearing out lots of references to sections, joins that won't be needed</a> etc.</p>
      <p>Carrying on the code culling for a few more days and then starting to unfiy various names (so any date field starts with date_ rather than them swapping around) and changing the calls to match.</p>

      <!-- IMAGE NEEDED HERE -->
    </section>

    <section id='make-like-a-tree' class='feature'>
      <h2>Trees</h2>
      <p>The main point of this refactor was to introduce a tree structure for content to replace the quagmire of sections &amp; page the CMS had previously.</p>
      <p>Before we changed it the CMS would treat parts of a URL as a section, and others as a page. This is a rough idea psedu code of what would happen (nothing like the real code):</p>
      <p><code>
        $URL = "/projects/wildfire/6.html";<br>
        $SECTIONS = array("/projects/", "/projects/wildfire/");<br>
        $PAGE = "6";<br>
      </code></p>
      <p>In that example everything except for "6" would be queried via the Section database table and then "6" would be checked in the Page database. The Page would have to have a reference set as being inside the one of those Sections.</p>
      <p>Somewhere along the line, years ago, we thought that was a good idea. Since then we've realised it clearly wasn't.</p>
      <h3>Problems</h3>
      <p>This old way had several issues with it that have caused numerous headaches in its life span; but the big one should of been obvious and can be summed up easily.</p>
      <p><strong>We were treating content of the website differently purely based on if it had children or not.</strong></p>
      <p>As an example of why this is a bad idea, how about we take the <code>$URL</code> mentioned above. We've carefully added the Pages in the right places to match but now we need a slight change:</p>
      <p><code>
        $URL = "/projects/wildfire/6/help";
      </code></p>
      <p>Adding a help page about "6" in a relevant place on the website. As "6" itself is a page, this isn't possible without reengineering all the exisiting content; you can imagine how painful that can be on larger websites.</p>
      <p>The other nail in the coffin for this old approach was the functionality differed on Page &amp; Section. In particular, imagery was missing on Sections but present on Pages, this had to get written in many times.</p>
      <h3>Solution</h3>
      <p>By merging Section &amp; Page together creating a generalised tree database model we solved this issue and opened up a few new interesting things for the CMS.</p>
    </section>

    <section id="i-feel-the-need" class='feature'>
      <h2>URL mapping (and some speed)</h2>
      <p>With now just a single Content model to worry about the CMS lookup functions would already be faster as there are less <code>MySQL</code> queries to do, but why not make them even faster still...</p>
      <p>By adding an extra database table in to the mix (originally called <a href="https://github.com/phpwax/wildfire/commit/58b5778ac14be909c4993d41d766b57a16c0f2cb">CmsUrlMap</a>) we could reduce the incoming look up time by quite a chunk.</p>
      <p>Now the code effectively looks for just the one item:</p>
      <p><code>
        $URL = "/projects/wildfire/6.html";<br>
        $URL_MAP_PERMALINK = "/projects/wildfire/6";<br>
      </code></p>
      <p>Instead of having to query a tree mechanism as before, all it had to do was look for the matching URL in the table and fetch the matching rows. This does mean that writes became slightly slower (2 tables instead of one) but provides much faster reads.</p>
      <p>Another nice side effect is being able to deprecate some of the older functionality in the main controller.</p>
    </section>

    <section id="languages-and-utf8" class='feature'>
      <h2>Language support</h2>

      <p>As we now only had a single Content model, language support became much easier. This version of the CMS was to support multiple languages out of the box with just some basic config changes required to enabled as many as you need.</p>
      <p><a href="https://github.com/phpwax/wildfire/commit/f029c3e3b7516db97389c1bfc6c415c62ceb4498">Right at the start of the rewrite</a> there are some commits dedicated to adding this in to the mapping mechanism within the CMS:</p>
      <p>However, with the changes made to make content lookups faster (see below) this was altered qute a lot and eventutally became a static array quite low down in the MVC stack.</p>
      <p>Ensuring utf-8 is being used on the connections to the database for PDO and various string functions etc are utf-8 safe was arduous at times, but worthwhile. Certain parts of this are still going to be dependant on the individual application to respect the charset being used etc.</p>

    </section>

    <section id="smarter-editing" class='feature'>
      <h2>A more dynamic CMS</h2>
      <p>A big bug-bear of the previous generation was customisation inside the CMS itself; changing or adding just one new field to a model meant making a new form or view.</p>
      <h3>Listing</h3>
      <p>To add in a new filter or column to list was a pain, now it's based on the model, much easier.</p>
      <h3>Editing</h3>
      <p>Pretty much since the start of the CMS the editing views were handcoded for each section and had to be updated every time you changed something. By the time you get to large sites with lots of new and custom fields that are used are various different page layouts it is a real pain to maintain.</p>
      <p>Instead of all this manual outputting we made the forms and lists smarter and based on the data held on the Model. Now when you add a custom field to Content all you need to do is tell the model how &amp; where to be displayed within the CMS and it does the hard work for you.</p>
      <h4>Files &amp; More</h4>
      <p>As some data you may want to customise for easier display, such as files, there needs to be an extra mechanism to allow simple changes to seub sections of the form. We handle this by making use of the partial system and checking for a compatible view in the stack, if it is found then render that instead of the default.</p>
      <p>A good example of this is on the Content editing form, where joins can be controlled via simple check boxes built into the CMS.</p>
      <h4>Joins</h4>
      <p>This basic interface for setting joins from one model to another in an automated fashion is also customisable; you just have to say the field lives in the 'Relationships' group and the rest happens automatically.</p>

    </section>
    <section id="shit-happens" class='feature' >
      <h2>Event hooks</h2>
      <p>During the rewrite one of the main changes to the actual coding style was swapping over to make use of the new WaxEvent methodology. In the same way that partials are used to contain repeatable blocks of layout, events do similar for the controller code.</p>
      <p>Now instead of having large functions we tried to make much smaller and encapsulated chunks that can be used anywhere and and inconjunction with others. You can then clear or add to that event to only alter that small segment.</p>
      <p>In this version the code is a bit rough and ready so its not as modular as would like it to be, but you can see <a href="https://github.com/phpwax/wildfire/blob/v6/lib/controller/CMSAdminComponent.php">plenty of examples in the lower level controllers</a>.</p>
    </section>

    <section id="new-shiny" class='feature'>
      <h2>HTML 5</h2>
      <p>Bearing in mind, this was 2011, so quite early on in the adoption of HTML5 feature set and only really top end browsers supported it. However, we like to develop for the future so replaced the flash uploadng tool from version 5 with a HTML5 uploader instead.</p>
      <p>A much nicer experience than flash, although it did prove to be tricky to get right in the begining. Making use of the new javascript File API, XMLHttpRequest and good old drag &amp; drop the files are uploaded asyncronously and then the main listing is automatically updated.</p>
      <p>Honestly, there are a few issues with this and the method for doing it has chnaged as the HTML5 spec has evolved.</p>
    </section>


    <section id="pretty-pictures" class='feature gallery'>
      <a rel="gallery" href="/projects/wildfire/6/gallery/login.png" class='fancybox'><img src="/projects/wildfire/6/gallery/login.png" alt="Login page"></a>
      <a rel="gallery" href="/projects/wildfire/6/gallery/dash.png" class='fancybox'><img src="/projects/wildfire/6/gallery/dash.png" alt="Dashboard"></a>
      <a rel="gallery" href="/projects/wildfire/6/gallery/listing.png" class='fancybox'><img src="/projects/wildfire/6/gallery/listing.png" alt="Listing page"></a>
      <a rel="gallery" href="/projects/wildfire/6/gallery/editing-1.png" class='fancybox'><img src="/projects/wildfire/6/gallery/editing-1.png" alt="Edit page"></a>
      <a rel="gallery" href="/projects/wildfire/6/gallery/editing-files.png" class='fancybox'><img src="/projects/wildfire/6/gallery/editing-files.png" alt="Edit page (files)"></a>
      <a rel="gallery" href="/projects/wildfire/6/gallery/editing-relationships.png" class='fancybox'><img src="/projects/wildfire/6/gallery/editing-relationships.png" alt="Edit page (relationships)"></a>
      <a rel="gallery" href="/projects/wildfire/6/gallery/files.png" class='fancybox'><img src="/projects/wildfire/6/gallery/files.png" alt="Files listing"></a>

    </section>

    <section id="bits" class='feature'>
      <h2>Odds and sodds</h2>
      <p>Outside of the key features there were many other things changed in this version; almost every file was changed in some way. While I don't want to go in to extreme detail, here are some of the highlights.</p>
      <h3>New editor, with templates</h3>
      <p>During the development of version 6 we replaced our text editor. Moving over from WYM Editor to TinyMCE gave us a lot of javascript coding to do, but it gives a more rounded experience and has neater ties with jQuery, which is what we mostly use in the CMS.</p>
      <p>Another factor we went with TinyMCE is the built in template tool that allows us to do more complicated layout of content by providing small HTML snippets whose copy can be replaced. Really makes things like multi-column pages easier while still allowing the client to control the content.</p>
    </section>

    <section class='feature'>
      <p>Have a read about the other versions of Wildfire; theres always some new interesting feature being built.</p>
      <a href="/projects/wildfire/" class='button clearfix'><span class='action'>►</span><span>More about Wildfire</span></a>
    </section>

    <script src='http://www.google.com/jsapi?'  type='text/javascript'></script>
    <script type="text/javascript">google.load('jquery', '1.7');</script>
    <script src='/javascripts/fancybox.js' type='text/javascript'></script>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-927511-5']);
    _gaq.push(['_setDomainName', 'charlesmarshall.co.uk']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</body>
</html>